!function(){"use strict";angular.module("corporateDashboard.directives").directive("d3Bars",["d3",function(t){return{restrict:"EA",scope:{data:"=",label:"@",onClick:"&"},link:function(e,n,a){var r={top:30,right:40,bottom:30,left:40},o=parseInt(t.select("#bar-chart").style("width"))-r.left-r.right,i=o>500?.5:1,s=o*i-r.top-r.bottom,c=t.select(n[0]).append("svg").attr("width",o+r.left+r.right).attr("height",s+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")");window.onresize=function(){return e.$apply()},e.$watch(function(){return angular.element(window)[0].innerWidth},function(){return e.render(e.data)}),e.$watch("data",function(t,n){return e.render(t)},!0),e.render=function(e){var n=t.scale.ordinal().rangeRoundBands([0,o],.1),a=t.scale.linear().range([s,0]);n.domain(e.map(function(t){return t.date})),a.domain([0,t.max(e,function(t){return t.numIssues})]);var i=t.svg.axis().scale(n).orient("bottom"),l=t.svg.axis().scale(a).orient("left");c.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(i),c.append("g").attr("class","y axis").call(l),c.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").style("font-size","8px").attr("x",function(t){return n(t.date)}).attr("y",s).attr("height",0).transition().duration(500).attr("y",function(t){return a(t.numIssues)}).attr("height",function(t){return s-a(t.numIssues)}).attr("width",n.rangeBand()),c.append("text").attr("x",o/2).attr("y",0-r.top/2).attr("text-anchor","middle").style("font-size","16px").text("Reported Issues Over Time")}}}}]).directive("d3Lines",["d3",function(t){return{restrict:"EA",scope:{data:"=",label:"@",onClick:"&"},link:function(e,n,a){var r={top:30,right:40,bottom:30,left:40},o=parseInt(t.select("#line-chart").style("width"))-r.left-r.right,i=o>500?.5:1,s=o*i-r.top-r.bottom,c=t.select(n[0]).append("svg").attr("width",o+r.left+r.right).attr("height",s+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")");window.onresize=function(){return e.$apply()},e.$watch(function(){return angular.element(window)[0].innerWidth},function(){return e.render(e.data)}),e.$watch("data",function(t,n){return e.render(t)},!0),e.render=function(e){var n=t.time.format("%d-%b-%y").parse,a=t.time.scale().range([0,o]),i=t.scale.linear().range([s,0]),l=t.svg.axis().scale(a).orient("bottom").ticks(5),d=t.svg.axis().scale(i).orient("left").ticks(5),u=t.svg.line().x(function(t){return a(t.date)}).y(function(t){return i(t.close)});t.csv("./data/data.csv",function(e,p){p.forEach(function(t){t.date=n(t.date),t.close=+t.close}),a.domain(t.extent(p,function(t){return t.date})),i.domain([0,t.max(p,function(t){return t.close})]),c.append("path").attr("class","line").attr("d",u(p)),c.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(l),c.append("g").attr("class","y axis").call(d),c.append("text").attr("x",o/2).attr("y",0-r.top/2).attr("text-anchor","middle").style("font-size","16px").text("Paying Customers Over Time")})}}}}]).directive("locationMap",["d3",function(t){return{restrict:"E",scope:{data:"="},link:function(e,n,a){var r=parseInt(t.select("#map").style("width")),o=.5,i=r*o,s=t.select(n[0]).append("svg").attr("width",r).attr("height",i).append("g");window.onresize=function(){return e.$apply()},e.$watch(function(){return angular.element(window)[0].innerWidth},function(){return e.render(e.data)}),e.$watch("data",function(t,n){return e.render(t)},!0),e.render=function(e){var n=t.geo.mercator().translate([4*r/5,i+i/8]).scale(r/3),a=t.geo.path().projection(n),o=s.append("g"),c=t.select("body").append("div").attr("class","tooltip").style("opacity",0);o.selectAll("path").data(topojson.object(e,e.objects.countries).geometries).enter().append("path").attr("d",a),t.json("https://fleemaja.github.io/corporate_dashboard/data/cities.json",function(e,a){var i=r<500?[5,15]:[10,30];i=r<1200?i:[20,50];var s=t.scale.linear().domain([1,700]).range(i);o.selectAll("circle").data(a).enter().append("circle").attr("class","meteor").attr("cx",function(t){return n([t.coordinates[1],t.coordinates[0]])[0]}).attr("cy",function(t){return n([t.coordinates[1],t.coordinates[0]])[1]}).attr("r",function(t){return s(t.numberOfEmployees)}).style("fill","#4682b4").on("mouseover",function(e){c.transition().duration(200).style("opacity",.9),c.html("<strong>City</strong>: "+e.city+"<br/><strong>Number of Employees</strong>: "+e.numberOfEmployees).style("left",t.event.pageX+"px").style("top",t.event.pageY-28+"px")}).on("mouseout",function(t){c.transition().duration(500).style("opacity",0)})})}}}}])}();